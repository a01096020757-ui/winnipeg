<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Winnipeg / MMIWG – Kinetic Poem</title>
  <style>
    :root{
      --bg: #0b0f14;
      --text: rgba(235, 240, 255, 0.92);
      --muted: rgba(200, 210, 235, 0.72);
      --red-text: #ff4d4d;
    }

    html, body { height: 100%; margin: 0; background: var(--bg); }
    
    body{
      font-family: ui-serif, Georgia, "Times New Roman", serif;
      overflow: hidden;
    }

    /* ▼▼▼ 배경 이미지 설정 (수정 완료) ▼▼▼ */
    #map {
      position: fixed;
      inset: 0;
      
      /* 범인 검거 완료: bg.png.png 적용 */
      background-image: url("bg.png.png");
      
      background-position: center;
      background-size: cover;
      background-repeat: no-repeat;
      
      /* 이미지 분위기 보정 */
      filter: contrast(1.08) saturate(1.05);
      transform: scale(1.02);
      
      /* 글자보다 뒤에 가도록 순서 설정 */
      z-index: 0; 
    }

    /* 글자가 잘 보이도록 배경 위에 까는 얇은 막 */
    #veil{
      position: fixed;
      inset: 0;
      background:
        radial-gradient(ellipse at 50% 40%, rgba(0,0,0,0.08), rgba(0,0,0,0.52)),
        linear-gradient(to bottom, rgba(0,0,0,0.18), rgba(0,0,0,0.30));
      pointer-events: none;
      z-index: 1; /* 배경보다 위에 */
    }

    /* 텍스트 컨텐츠들 (가장 위에) */
    .orbiter-container, #dressContainer, #hint {
      z-index: 2; 
    }

    /* ----- 이하 애니메이션 및 텍스트 스타일 ----- */
    .orbiter-container{
      position: fixed; left: 50vw; top: 42vh; width: 0; height: 0; pointer-events: none;
    }
    .orbiter-span{
      position: absolute; left: 0; top: 0; white-space: nowrap; color: var(--text);
      text-shadow: 0 2px 10px rgba(0,0,0,0.8); letter-spacing: .03em;
      transform: translate(-50%, -50%); will-change: transform, opacity;
      user-select: none;
    }
    .orbiter-title{ font-size: clamp(16px, 2vw, 24px); font-weight: 300; font-style: italic; }
    .orbiter-wing{ font-size: clamp(12px, 1.3vw, 16px); color: var(--muted); font-family: ui-sans-serif, system-ui, sans-serif; text-transform: lowercase; }

    #dressContainer{
      position: fixed; left: 50vw; top: 66vh;
      width: min(520px, 86vw); height: min(640px, 90vh);
      transform: translate(-50%, -50%); pointer-events: none;
    }
    .dress-particle{
      position: absolute; left: 0; top: 0; white-space: nowrap; color: var(--red-text);
      font-family: ui-serif, Georgia, "Times New Roman", serif; font-style: italic; will-change: transform, opacity, filter;
      text-shadow: 0 0 10px rgba(255,0,0,.65), 0 0 22px rgba(255,0,0,.45); transform: translate(-50%, -50%);
    }
    .dress-particle.main{ font-size: clamp(24px, 3vw, 38px); font-weight: 700; letter-spacing: 0.10em; z-index: 10; }
    .dress-particle.body{ font-size: clamp(14px, 1.5vw, 20px); opacity: 0.85; }
    
    #hint{
      position: fixed; left: 14px; bottom: 12px; color: rgba(255,255,255,.55);
      font-family: ui-sans-serif, system-ui, sans-serif; font-size: 12px;
      text-shadow: 0 2px 10px rgba(0,0,0,.55); user-select: none; pointer-events: none;
    }
  </style>
</head>

<body>
  <div id="map"></div>
  <div id="veil"></div>
  <div class="orbiter-container" id="lakeOrbit"></div>
  <div id="dressContainer"></div>
  <div id="hint">click: pause/resume</div>

  <script>
    function mapRange(v, iMin, iMax, oMin, oMax){ return (v - iMin)*(oMax - oMin)/(iMax - iMin) + oMin; }
    let paused = false;
    window.addEventListener("click", () => paused = !paused);

    /* Part 1: Lake Orbit Text */
    const lakeOrbitContainer = document.getElementById("lakeOrbit");
    const PHRASE_MAIN = "Winnipeg, the word that does not cross the ocean";
    const PHRASE_WING = ["winged word", "moving water", "lake listens", "river meets river", "sound deep water", "echo boundary"];
    const orbiters = [];
    const orbitCount = 14;

    for(let i=0; i<orbitCount; i++){
      const sp = document.createElement("span");
      const isTitle = (i % 4 === 0);
      sp.className = isTitle ? "orbiter-span orbiter-title" : "orbiter-span orbiter-wing";
      sp.textContent = isTitle ? PHRASE_MAIN : PHRASE_WING[i % PHRASE_WING.length];
      lakeOrbitContainer.appendChild(sp);
      orbiters.push({ el: sp, i, isTitle });
    }

    /* Part 2: MMIWG Red Dress */
    const dressContainer = document.getElementById("dressContainer");
    const dressMap = [
      { text: "MMIWG", type: "main", x: 50, y: 6 },
      { text: "the", type: "body", x: 42, y: 20 }, { text: "bodies", type: "body", x: 58, y: 20 },
      { text: "that", type: "body", x: 46, y: 34 }, { text: "did", type: "body", x: 54, y: 34 },
      { text: "not", type: "body", x: 36, y: 54 }, { text: "make", type: "body", x: 64, y: 54 },
      { text: "it", type: "body", x: 25, y: 74 }, { text: "across", type: "body", x: 75, y: 74 },
      { text: "life", type: "body", x: 50, y: 90 },
      { text: "👗", type: "body", x: 40, y: 44, opacity: 0.65 }, { text: "👗", type: "body", x: 60, y: 44, opacity: 0.65 },
      { text: "MMIWG", type: "body", x: 50, y: 48, opacity: 0.40 }, { text: "life", type: "body", x: 35, y: 86, opacity: 0.55 },
      { text: "life", type: "body", x: 65, y: 86, opacity: 0.55 }
    ];

    const dressParticles = [];
    dressMap.forEach((pt, idx) => {
      const s = document.createElement("span");
      s.textContent = pt.text;
      s.className = `dress-particle ${pt.type}`;
      s.style.left = `${pt.x}%`; s.style.top = `${pt.y}%`;
      if(pt.opacity != null) s.style.opacity = pt.opacity;
      dressContainer.appendChild(s);
      dressParticles.push({ el: s, idx });
    });

    let t0 = performance.now();
    function animate(now){
      requestAnimationFrame(animate);
      if(paused) return;
      const t = (now - t0) / 1000;
      orbiters.forEach(({el, i, isTitle}) => {
        const angle = t * 0.15 + i * (Math.PI * 2 / orbitCount);
        const wobble = Math.sin(t * 0.8 + i) * 14;
        const rX = 240 + wobble; const rY = 150 + wobble * 0.7;
        const x = Math.cos(angle) * rX; const y = Math.sin(angle) * rY;
        const depth = Math.sin(angle);
        const opacity = isTitle ? 0.92 : mapRange(depth, -1, 1, 0.40, 0.82);
        const scale = mapRange(depth, -1, 1, 0.86, 1.10);
        const rotation = (angle * 180 / Math.PI) + 90;
        el.style.opacity = opacity.toFixed(3);
        el.style.transform = `translate(-50%, -50%) translate3d(${x}px, ${y}px, 0) rotate(${rotation}deg) scale(${scale})`;
      });
      dressParticles.forEach(({el, idx}) => {
        const floatSpeed = 1.2;
        const dx = Math.sin(t * floatSpeed + idx) * 3;
        const dy = Math.cos(t * floatSpeed * 0.8 + idx * 0.5) * 6;
        const rot = Math.sin(t * 0.5 + idx) * 3;
        const glow = mapRange(Math.sin(t * 2 + idx), -1, 1, 0.85, 1.35);
        el.style.filter = `brightness(${glow})`;
        el.style.transform = `translate(-50%, -50%) translate3d(${dx}px, ${dy}px, 0) rotate(${rot}deg)`;
      });
    }
    requestAnimationFrame(animate);
  </script>
</body>
</html>